ðŸ”§ Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð•: Ð—Ð°Ñ†Ð¸ÐºÐ»Ð¸Ð²Ð°Ð½Ð¸Ðµ Ñ€ÐµÐ´Ð¸Ñ€ÐµÐºÑ‚Ð° Ð² Nginx
============================================

âŒ ÐŸÐ ÐžÐ‘Ð›Ð•ÐœÐ:
ÐžÑˆÐ¸Ð±ÐºÐ°: "rewrite or internal redirection cycle while internally redirecting to "/index.html""

âœ… ÐŸÐ Ð˜Ð§Ð˜ÐÐ:
ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ try_files Ð² Nginx ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð±ÐµÑÐºÐ¾Ð½ÐµÑ‡Ð½Ñ‹Ð¹ Ñ†Ð¸ÐºÐ» Ñ€ÐµÐ´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ð²

ðŸ”§ Ð Ð•Ð¨Ð•ÐÐ˜Ð•:

1. ÐŸÐžÐ”ÐšÐ›Ð®Ð§Ð•ÐÐ˜Ð• Ðš Ð¡Ð•Ð Ð’Ð•Ð Ð£:
   ssh root@147.45.110.220

2. Ð¡ÐžÐ—Ð”ÐÐÐ˜Ð• Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐÐžÐ™ ÐšÐžÐÐ¤Ð˜Ð“Ð£Ð ÐÐ¦Ð˜Ð˜ NGINX:
   cat > /etc/nginx/sites-available/nodeon << 'EOF'
   server {
       listen 443 ssl;
       server_name sistemypro.ru www.sistemypro.ru;
       
       ssl_certificate /etc/letsencrypt/live/sistemypro.ru/fullchain.pem;
       ssl_certificate_key /etc/letsencrypt/live/sistemypro.ru/privkey.pem;
       include /etc/letsencrypt/options-ssl-nginx.conf;
       ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
       
       root /root/nodeon/public;
       index index.html;
       
       # Serve static files directly
       location / {
           try_files $uri $uri/ @fallback;
       }
       
       # Fallback to index.html for SPA routing
       location @fallback {
           try_files /index.html =404;
       }
       
       # API routes - proxy to Node.js
       location /api/ {
           proxy_pass http://localhost:3000;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
           proxy_set_header X-Forwarded-Host $host;
           proxy_set_header X-Forwarded-Port $server_port;
       }
       
       # Health check - proxy to Node.js
       location /health {
           proxy_pass http://localhost:3000;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
       }
   }

   server {
       listen 80;
       server_name sistemypro.ru www.sistemypro.ru;
       return 301 https://$host$request_uri;
   }
   EOF

3. ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ ÐšÐžÐÐ¤Ð˜Ð“Ð£Ð ÐÐ¦Ð˜Ð˜:
   nginx -t

4. ÐŸÐ•Ð Ð•Ð—ÐÐŸÐ£Ð¡Ðš NGINX:
   systemctl restart nginx

5. ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð¡Ð¢ÐÐ¢Ð£Ð¡Ð:
   systemctl status nginx

6. Ð¢Ð•Ð¡Ð¢Ð˜Ð ÐžÐ’ÐÐÐ˜Ð•:
   curl -I https://sistemypro.ru/
   curl -I https://sistemypro.ru/api/health

ðŸ” ÐÐ›Ð¬Ð¢Ð•Ð ÐÐÐ¢Ð˜Ð’ÐÐžÐ• Ð Ð•Ð¨Ð•ÐÐ˜Ð• (ÐµÑÐ»Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ðµ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚):

Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð±Ð»Ð¾Ðº location / Ð½Ð°:
   location / {
       try_files $uri $uri/ /index.html;
       add_header Cache-Control "no-cache, no-store, must-revalidate";
       add_header Pragma "no-cache";
       add_header Expires "0";
   }

Ð˜Ð»Ð¸ ÐµÑ‰Ðµ Ð¿Ñ€Ð¾Ñ‰Ðµ:
   location / {
       root /root/nodeon/public;
       index index.html;
       try_files $uri $uri/ =404;
   }
   
   location /app {
       root /root/nodeon/public;
       try_files /index.html =404;
   }

ðŸš¨ Ð•Ð¡Ð›Ð˜ ÐÐ˜Ð§Ð•Ð“Ðž ÐÐ• ÐŸÐžÐœÐžÐ“ÐÐ•Ð¢:

1. Ð£Ð”ÐÐ›Ð˜Ð¢Ð• Ð¡Ð¢ÐÐ Ð£Ð® ÐšÐžÐÐ¤Ð˜Ð“Ð£Ð ÐÐ¦Ð˜Ð®:
   rm /etc/nginx/sites-available/nodeon

2. Ð¡ÐžÐ—Ð”ÐÐ™Ð¢Ð• ÐœÐ˜ÐÐ˜ÐœÐÐ›Ð¬ÐÐ£Ð® ÐšÐžÐÐ¤Ð˜Ð“Ð£Ð ÐÐ¦Ð˜Ð®:
   cat > /etc/nginx/sites-available/nodeon << 'EOF'
   server {
       listen 443 ssl;
       server_name sistemypro.ru www.sistemypro.ru;
       
       ssl_certificate /etc/letsencrypt/live/sistemypro.ru/fullchain.pem;
       ssl_certificate_key /etc/letsencrypt/live/sistemypro.ru/privkey.pem;
       include /etc/letsencrypt/options-ssl-nginx.conf;
       ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
       
       root /root/nodeon/public;
       index index.html;
       
       location / {
           root /root/nodeon/public;
           index index.html;
       }
       
       location /api/ {
           proxy_pass http://localhost:3000;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
       }
   }

   server {
       listen 80;
       server_name sistemypro.ru www.sistemypro.ru;
       return 301 https://$host$request_uri;
   }
   EOF

3. ÐŸÐ ÐžÐ’Ð•Ð Ð¬Ð¢Ð• Ð˜ ÐŸÐ•Ð Ð•Ð—ÐÐŸÐ£Ð¡Ð¢Ð˜Ð¢Ð•:
   nginx -t
   systemctl restart nginx

âœ… Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢:
Ð¡Ð°Ð¹Ñ‚ https://sistemypro.ru Ð´Ð¾Ð»Ð¶ÐµÐ½ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð±ÐµÐ· Ð¾ÑˆÐ¸Ð±ÐºÐ¸ 500

ðŸ“ ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ:
- https://sistemypro.ru - Ð³Ð»Ð°Ð²Ð½Ð°Ñ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ð°
- https://sistemypro.ru/api/health - API health check

