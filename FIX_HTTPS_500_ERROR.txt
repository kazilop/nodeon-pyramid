ðŸ”§ Ð˜ÐÐ¡Ð¢Ð Ð£ÐšÐ¦Ð˜Ð¯: Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ 500 Internal Server Error Ð½Ð° HTTPS
================================================================

âŒ ÐŸÐ ÐžÐ‘Ð›Ð•ÐœÐ:
ÐŸÐ¾ÑÐ»Ðµ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð° ÑÐ°Ð¹Ñ‚ https://sistemypro.ru Ð²Ñ‹Ð´Ð°ÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÑƒ 500 Internal Server Error

âœ… Ð Ð•Ð¨Ð•ÐÐ˜Ð•:
ÐÑƒÐ¶Ð½Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¸ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Node.js Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ñ‡ÐµÑ€ÐµÐ· PM2

ðŸ“‹ ÐŸÐžÐ¨ÐÐ“ÐžÐ’ÐÐ¯ Ð˜ÐÐ¡Ð¢Ð Ð£ÐšÐ¦Ð˜Ð¯:

1. ÐŸÐžÐ”ÐšÐ›Ð®Ð§Ð•ÐÐ˜Ð• Ðš Ð¡Ð•Ð Ð’Ð•Ð Ð£:
   ssh root@147.45.110.220

2. ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð¡Ð¢ÐÐ¢Ð£Ð¡Ð PM2:
   pm2 status
   
   Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾ Ð¸Ð»Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÑƒ, Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ð¼ Ðº ÑˆÐ°Ð³Ñƒ 3

3. ÐŸÐ•Ð Ð•Ð¥ÐžÐ” Ð’ ÐŸÐÐŸÐšÐ£ ÐŸÐ Ð˜Ð›ÐžÐ–Ð•ÐÐ˜Ð¯:
   cd /root/nodeon

4. ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð¤ÐÐ™Ð›ÐžÐ’:
   ls -la
   
   Ð”Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»Ñ‹: server.js, package.json, .env, ecosystem.config.js

5. ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð›ÐžÐ“ÐžÐ’ PM2:
   pm2 logs nodeon-pyramid --lines 20
   
   Ð˜Ñ‰Ð¸Ñ‚Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð² Ð»Ð¾Ð³Ð°Ñ…

6. ÐŸÐ•Ð Ð•Ð—ÐÐŸÐ£Ð¡Ðš ÐŸÐ Ð˜Ð›ÐžÐ–Ð•ÐÐ˜Ð¯:
   pm2 restart nodeon-pyramid
   
   Ð˜Ð»Ð¸ ÐµÑÐ»Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾:
   pm2 start ecosystem.config.js

7. ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ ÐŸÐžÐ Ð¢Ð 3000:
   netstat -tlnp | grep 3000
   
   Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ñ€Ñ‚ 3000 ÑÐ»ÑƒÑˆÐ°ÐµÑ‚ÑÑ

8. Ð¢Ð•Ð¡Ð¢ Ð›ÐžÐšÐÐ›Ð¬ÐÐžÐ“Ðž ÐŸÐžÐ”ÐšÐ›Ð®Ð§Ð•ÐÐ˜Ð¯:
   curl http://localhost:3000/health
   
   Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ {"status":"ok"}

9. ÐŸÐ•Ð Ð•Ð—ÐÐŸÐ£Ð¡Ðš NGINX:
   systemctl restart nginx

10. ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð¡Ð¢ÐÐ¢Ð£Ð¡Ð NGINX:
    systemctl status nginx

11. Ð¢Ð•Ð¡Ð¢ HTTPS Ð¡ÐÐ™Ð¢Ð:
    curl -I https://sistemypro.ru
    
    Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ HTTP/2 200

ðŸ” Ð”Ð˜ÐÐ“ÐÐžÐ¡Ð¢Ð˜ÐšÐ ÐŸÐ ÐžÐ‘Ð›Ð•Ðœ:

Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ:

A. ÐŸÐ ÐžÐ’Ð•Ð Ð¬Ð¢Ð• .env Ð¤ÐÐ™Ð›:
   cat .env
   
   Ð”Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð²ÑÐµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ:
   - NODE_ENV=production
   - PORT=3000
   - SUPABASE_URL=...
   - SUPABASE_ANON_KEY=...
   - TELEGRAM_BOT_TOKEN=...
   - TELEGRAM_BOT_USERNAME=pro_stars_bot
   - SECRET_KEY=your_secret_key_here
   - DEVELOPER_TELEGRAM_ID=207940967

B. ÐŸÐ ÐžÐ’Ð•Ð Ð¬Ð¢Ð• package.json:
   cat package.json
   
   Ð”Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸: express, pm2, dotenv, node-fetch

C. Ð£Ð¡Ð¢ÐÐÐžÐ’Ð˜Ð¢Ð• Ð—ÐÐ’Ð˜Ð¡Ð˜ÐœÐžÐ¡Ð¢Ð˜:
   npm install

D. ÐŸÐ ÐžÐ’Ð•Ð Ð¬Ð¢Ð• server.js:
   head -20 server.js
   
   Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð½Ð°Ñ‡Ð¸Ð½Ð°Ñ‚ÑŒÑÑ Ñ require('express')

E. ÐŸÐ ÐžÐ’Ð•Ð Ð¬Ð¢Ð• ecosystem.config.js:
   cat ecosystem.config.js
   
   Ð”Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ PM2

ðŸš¨ Ð•Ð¡Ð›Ð˜ ÐÐ˜Ð§Ð•Ð“Ðž ÐÐ• ÐŸÐžÐœÐžÐ“ÐÐ•Ð¢:

1. Ð£Ð”ÐÐ›Ð˜Ð¢Ð• Ð’Ð¡Ð• ÐŸÐ ÐžÐ¦Ð•Ð¡Ð¡Ð« PM2:
   pm2 delete all

2. Ð¡ÐžÐ—Ð”ÐÐ™Ð¢Ð• ecosystem.config.js Ð—ÐÐÐžÐ’Ðž:
   cat > ecosystem.config.js << 'EOF'
   module.exports = {
     apps: [{
       name: "nodeon-pyramid",
       script: "server.js",
       instances: 1,
       autorestart: true,
       watch: false,
       max_memory_restart: "1G",
       env: {
         NODE_ENV: "production",
         PORT: 3000
       },
       error_file: "./logs/err.log",
       out_file: "./logs/out.log",
       log_file: "./logs/combined.log",
       time: true
     }]
   };
   EOF

3. Ð¡ÐžÐ—Ð”ÐÐ™Ð¢Ð• ÐŸÐÐŸÐšÐ£ Ð›ÐžÐ“ÐžÐ’:
   mkdir -p logs

4. Ð—ÐÐŸÐ£Ð¡Ð¢Ð˜Ð¢Ð• ÐŸÐ Ð˜Ð›ÐžÐ–Ð•ÐÐ˜Ð•:
   pm2 start ecosystem.config.js

5. Ð¡ÐžÐ¥Ð ÐÐÐ˜Ð¢Ð• ÐšÐžÐÐ¤Ð˜Ð“Ð£Ð ÐÐ¦Ð˜Ð®:
   pm2 save

6. ÐŸÐ ÐžÐ’Ð•Ð Ð¬Ð¢Ð• Ð¡Ð¢ÐÐ¢Ð£Ð¡:
   pm2 status

ðŸ“ž ÐŸÐžÐ›Ð•Ð—ÐÐ«Ð• ÐšÐžÐœÐÐÐ”Ð«:

ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð² Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸:
pm2 logs nodeon-pyramid --follow

ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº Ð²ÑÐµÑ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²:
pm2 restart all
systemctl restart nginx

ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ñ€Ñ‚Ð¾Ð²:
netstat -tlnp | grep -E "(3000|80|443)"

ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ð² Node.js:
ps aux | grep node

ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð»Ð¾Ð³Ð¾Ð² Nginx:
tail -f /var/log/nginx/error.log

ðŸŒ Ð¤Ð˜ÐÐÐ›Ð¬ÐÐÐ¯ ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ:

ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð²ÑÐµÑ… ÑˆÐ°Ð³Ð¾Ð² Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ:
- https://sistemypro.ru (Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ Ð±ÐµÐ· Ð¾ÑˆÐ¸Ð±Ð¾Ðº)
- https://sistemypro.ru/api/health (Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ {"status":"ok"})

âœ… Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢:
Ð¡Ð°Ð¹Ñ‚ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð¿Ð¾ HTTPS Ð±ÐµÐ· Ð¾ÑˆÐ¸Ð±Ð¾Ðº 500

ðŸ“ Ð›ÐžÐ“Ð˜ Ð”Ð›Ð¯ ÐžÐ¢Ð›ÐÐ”ÐšÐ˜:
- PM2 Ð»Ð¾Ð³Ð¸: pm2 logs nodeon-pyramid
- Nginx Ð»Ð¾Ð³Ð¸: tail -f /var/log/nginx/error.log
- Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ðµ Ð»Ð¾Ð³Ð¸: journalctl -u nginx -f












