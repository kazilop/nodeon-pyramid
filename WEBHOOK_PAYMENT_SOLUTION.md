# ‚úÖ WEBHOOK –†–ï–®–ï–ù–ò–ï –î–õ–Ø –ü–õ–ê–¢–ï–ñ–ï–ô

## üéØ –ü–†–û–ë–õ–ï–ú–ê:
–ü–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ invoice –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. –ü–ª–∞—Ç–µ–∂ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ Telegram Bot
2. Mini App –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç callback –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
3. –ë–∞–ª–∞–Ω—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

## ‚úÖ –†–ï–®–ï–ù–ò–ï:

–°–æ–∑–¥–∞–Ω **webhook** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –æ—Ç Telegram Bot:
- Telegram Bot –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ successful_payment
- Webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂
- –ó–∞—á–∏—Å–ª—è–µ—Ç NDN –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## üìù –§–ê–ô–õ–´:

### **1. webhook.js:**
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç webhook –æ—Ç Telegram:
- –ü–æ–ª—É—á–∞–µ—Ç successful_payment
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (telegram_id, amount_ndn)
- –ó–∞—á–∏—Å–ª—è–µ—Ç NDN –Ω–∞ –±–∞–ª–∞–Ω—Å
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### **2. server.js:**
–î–æ–±–∞–≤–ª–µ–Ω webhook route:
```javascript
const webhookRoutes = require('./webhook');
app.use('/', webhookRoutes);
```

## üîß –ù–ê–°–¢–†–û–ô–ö–ê:

–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ:
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook –¥–ª—è Telegram Bot:
```bash
curl -X POST "https://api.telegram.org/bot<TOKEN>/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://sistemypro.ru/webhook/telegram"}'
```

## üéØ –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢:

1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ö—É–ø–∏—Ç—å NDN"
2. ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è invoice —Å—Å—ã–ª–∫–∞
3. ‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ tg.openLink()
4. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç Stars –≤ Telegram
5. ‚úÖ **Telegram Bot –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç successful_payment –≤ webhook** ‚Üê –ù–û–í–û–ï
6. ‚úÖ **Webhook –∑–∞—á–∏—Å–ª—è–µ—Ç NDN –Ω–∞ –±–∞–ª–∞–Ω—Å** ‚Üê –ù–û–í–û–ï
7. ‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** ‚Üê –ù–û–í–û–ï

## üì§ –ó–ê–ì–†–£–ñ–ï–ù–û –ù–ê –°–ï–†–í–ï–†:

- ‚úÖ `server-deployment/webhook.js` - Webhook handler
- ‚úÖ `server-deployment/server.js` - –î–æ–±–∞–≤–ª–µ–Ω route
- ‚úÖ PM2 –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- ‚úÖ Nginx –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook –¥–ª—è Telegram Bot
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∫—É–ø–∫—É NDN –∑–∞ Stars
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ NDN –∑–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å

–ì–æ—Ç–æ–≤–æ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ webhook!











