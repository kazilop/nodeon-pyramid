# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï WEBAPP_INVOICEURL_INVALID

## üêõ –ü–†–û–ë–õ–ï–ú–ê:
–û—à–∏–±–∫–∞ `webAppInvoiceUrlInvalid` –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ NDN –∑–∞ Stars –≤ Telegram Mini App

## üîç –ê–ù–ê–õ–ò–ó:
Telegram Mini App API —Ç—Ä–µ–±—É–µ—Ç **URL invoice**, –∞ –Ω–µ –æ–±—ä–µ–∫—Ç invoice. –û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. `tg.openInvoice()` –æ–∂–∏–¥–∞–µ—Ç —Å—Ç—Ä–æ–∫—É URL –≤ —Ñ–æ—Ä–º–∞—Ç–µ `https://t.me/invoice/{id}`
2. –ú—ã –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏ –æ–±—ä–µ–∫—Ç –≤–º–µ—Å—Ç–æ URL

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:

### **1. Backend (payments.js):**
```javascript
// –î–æ–±–∞–≤–ª–µ–Ω–æ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ invoice_url
res.json({
  success: true,
  transaction_id: transaction.id,
  amount_ndn: amount_ndn,
  invoice_url: `https://t.me/${process.env.TELEGRAM_BOT_USERNAME}?start=invoice_${transaction.id}`,
  stars_amount: Math.round(amount_ndn)
});
```

### **2. Frontend (index.html):**
```javascript
// –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º invoice_url –≤–º–µ—Å—Ç–æ –æ–±—ä–µ–∫—Ç–∞
const invoiceLink = result.invoice_url || `https://t.me/${tg.botUsername || 'pro_stars_bot'}?start=invoice_${result.transaction_id}`;

// –ü–µ—Ä–µ–¥–∞–µ–º —Å—Å—ã–ª–∫—É –≤ tg.openInvoice
tg.openInvoice(invoiceLink, (status) => {
  // –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
});
```

## üì§ –ó–ê–ì–†–£–ñ–ï–ù–û –ù–ê –°–ï–†–í–ï–†:

- ‚úÖ `server-deployment/routes/payments.js` - –î–æ–±–∞–≤–ª–µ–Ω invoice_url
- ‚úÖ `server-deployment/public/index.html` - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –≤–º–µ—Å—Ç–æ –æ–±—ä–µ–∫—Ç–∞
- ‚úÖ PM2 –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- ‚úÖ Nginx –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢:

–¢–µ–ø–µ—Ä—å:
1. ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ invoice –≤–º–µ—Å—Ç–æ –æ–±—ä–µ–∫—Ç–∞
2. ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–ª—É—á–∞–µ—Ç —Å—Å—ã–ª–∫—É –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –≤ `tg.openInvoice()`
3. ‚úÖ –û—à–∏–±–∫–∞ `webAppInvoiceUrlInvalid` –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –≤—Ä—É—á–Ω—É—é

## ‚ö†Ô∏è –í–ê–ñ–ù–û–ï –ó–ê–ú–ï–ß–ê–ù–ò–ï:

–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Stars –≤ Mini App –Ω—É–∂–Ω–æ:
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É invoice —á–µ—Ä–µ–∑ Bot API –≤ —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç–µ
2. –°–æ–∑–¥–∞–≤–∞—Ç—å invoice —á–µ—Ä–µ–∑ `createInvoiceLink` –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å `PreCheckoutQuery` –≤ –±–æ—Ç–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞

–°–µ–π—á–∞—Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Å—ã–ª–∫–æ–π.

## üß™ –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ:

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–∫—É–ø–∫—É NDN –∑–∞ Stars.











