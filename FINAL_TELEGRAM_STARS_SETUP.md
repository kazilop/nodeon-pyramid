# üöÄ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê TELEGRAM STARS

## üìö –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –û–§–ò–¶–ò–ê–õ–¨–ù–û–ô –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–ò

–ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Telegram](https://core.telegram.org/bots/payments-stars) –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥.

---

## üéØ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø –í–´–ü–û–õ–ù–ï–ù–´

### ‚úÖ **1. –¢–æ–ª—å–∫–æ Telegram Stars**
- –í—Å–µ –ø–ª–∞—Ç–µ–∂–∏ –∑–∞ NDN –æ—Å—É—â–µ—Å—Ç–≤–ª—è—é—Ç—Å—è –≤ **Telegram Stars**
- –í–∞–ª—é—Ç–∞: `XTR` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- –ö—É—Ä—Å: 1 Star = 1 NDN

### ‚úÖ **2. Bot API –º–µ—Ç–æ–¥—ã**
- `sendInvoice` - —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–æ–≤
- `answerPreCheckoutQuery` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π
- `refundStarPayment` - –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤

### ‚úÖ **3. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã**
- `/start` - –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
- `/terms` - —É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- `/support` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `/paysupport` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ –ø–ª–∞—Ç–µ–∂–∞–º

### ‚úÖ **4. Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ `pre_checkout_query`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ `successful_payment`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ `callback_query`

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–ò–°–¢–ï–ú–´

### **1. Telegram Bot** (`telegram_bot_stars_official.py`)
```python
# –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Stars
class NodeOnPyramidBot:
    async def create_invoice(self, amount):
        await context.bot.send_invoice(
            chat_id=user_id,
            title=f"–ü–æ–∫—É–ø–∫–∞ {amount} NDN",
            description=f"–ü–æ–∫—É–ø–∫–∞ {amount} NDN –∑–∞ {amount} Telegram Stars",
            payload=f"ndn_purchase_{user_id}_{amount}_{timestamp}",
            provider_token="",  # –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
            currency="XTR",     # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ XTR –¥–ª—è Stars
            prices=[LabeledPrice("NDN", amount * 100)]  # –í –∫–æ–ø–µ–π–∫–∞—Ö
        )
```

### **2. API —Å Webhook** (`main_telegram_webhook.py`)
```python
@app.post("/webhook")
async def telegram_webhook(request: Request):
    """Webhook –¥–ª—è Telegram –±–æ—Ç–∞"""
    data = await request.json()
    
    if 'pre_checkout_query' in data:
        await handle_pre_checkout_query(data['pre_checkout_query'])
    elif 'successful_payment' in data:
        await handle_successful_payment(data['message'])
```

### **3. –°–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ—à–µ–ª–µ–∫** (`CREATE_SERVER_WALLET.sql`)
```sql
-- –†–µ–∞–ª—å–Ω—ã–π —Ä–µ–∑–µ—Ä–≤ NDN
CREATE TABLE nodeon_server_wallet (
    balance_ndn DECIMAL(18,2) DEFAULT 1000000.0,  -- 1M NDN —Ä–µ–∑–µ—Ä–≤
    total_ndn_issued DECIMAL(18,2) DEFAULT 0.0,
    total_ndn_received DECIMAL(18,2) DEFAULT 0.0
);
```

---

## üöÄ –ü–û–®–ê–ì–û–í–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê (30 –º–∏–Ω—É—Ç)

### **–®–ê–ì 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (10 –º–∏–Ω—É—Ç)**

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Supabase:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://supabase.com/dashboard
   - –í–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–æ–µ–∫—Ç `ahxwpzgltlzlvrtrbanm`
   - –û—Ç–∫—Ä–æ–π—Ç–µ **SQL Editor**

2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç—ã:**
   ```sql
   -- –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ CREATE_SERVER_WALLET.sql
   -- –ó–∞—Ç–µ–º ADD_STARS_SUPPORT.sql
   ```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ Stars

### **–®–ê–ì 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞ (10 –º–∏–Ω—É—Ç)**

1. **–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ [@BotFather](https://t.me/BotFather):**
   ```
   /newbot
   NodeOn Pyramid Bot
   pro_stars_bot
   ```

2. **–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª—ã:**
   ```python
   TELEGRAM_BOT_TOKEN = "YOUR_BOT_TOKEN"
   ```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:**
   ```bash
   python setup_webhook_stars.py
   ```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏

### **–®–ê–ì 3: –ê–∫—Ç–∏–≤–∞—Ü–∏—è Stars (5 –º–∏–Ω—É—Ç)**

1. **–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ [@BotSupport](https://t.me/BotSupport):**
   - –£–∫–∞–∂–∏—Ç–µ ID –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
   - –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –∞–∫—Ç–∏–≤–∞—Ü–∏—é Stars
   - –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (1-3 –¥–Ω—è)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Stars –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –≤–∞—à–µ–≥–æ –±–æ—Ç–∞

### **–®–ê–ì 4: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ API (5 –º–∏–Ω—É—Ç)**

1. **–ó–∞–º–µ–Ω–∏—Ç–µ main.py:**
   ```bash
   cp main_telegram_webhook.py main.py
   ```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Railway:**
   ```bash
   railway up --detach
   ```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook:**
   ```bash
   python setup_webhook_stars.py
   ```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** API —Ä–∞–±–æ—Ç–∞–µ—Ç —Å webhook –¥–ª—è Telegram

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### **1. –¢–µ—Å—Ç –±–æ—Ç–∞:**
```bash
# –û—Ç–ø—Ä–∞–≤—å—Ç–µ /start –±–æ—Ç—É
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã: /terms, /support, /paysupport
```

### **2. –¢–µ—Å—Ç –ø–ª–∞—Ç–µ–∂–µ–π:**
```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∏–Ω–≤–æ–π—Å
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É pre_checkout_query
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É successful_payment
```

### **3. –¢–µ—Å—Ç API:**
```bash
python test_server_wallet.py
```

---

## üìã –ß–ï–ö–õ–ò–°–¢ –î–õ–Ø –ó–ê–ü–£–°–ö–ê

### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è Telegram:**
- ‚úÖ **2FA –≤–∫–ª—é—á–µ–Ω–∞** –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –±–æ—Ç–∞
- ‚úÖ **–ö–æ–º–∞–Ω–¥–∞ /terms** - —É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ **–ö–æ–º–∞–Ω–¥–∞ /support** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **–ö–æ–º–∞–Ω–¥–∞ /paysupport** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ –ø–ª–∞—Ç–µ–∂–∞–º
- ‚úÖ **Webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ **–°–µ—Ä–≤–µ—Ä —Å—Ç–∞–±–∏–ª–µ–Ω** —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏
- ‚úÖ **–í–æ–∑–≤—Ä–∞—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç** —á–µ—Ä–µ–∑ refundStarPayment

### **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ **–¢–æ–ª—å–∫–æ Telegram Stars** - –≤–∞–ª—é—Ç–∞ XTR
- ‚úÖ **Bot API –º–µ—Ç–æ–¥—ã** - sendInvoice, answerPreCheckoutQuery
- ‚úÖ **–°–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ—à–µ–ª–µ–∫** - —Ä–µ–∞–ª—å–Ω—ã–π —Ä–µ–∑–µ—Ä–≤ NDN
- ‚úÖ **Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞** - pre_checkout_query, successful_payment
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π** - –ø—Ä–æ–≤–µ—Ä–∫–∞ Telegram –¥–∞–Ω–Ω—ã—Ö

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç:

‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å** –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º Telegram
‚úÖ **–ü—Ä–∏–Ω–∏–º–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏** —Ç–æ–ª—å–∫–æ –≤ Telegram Stars
‚úÖ **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏** —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Bot API
‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —ç–º–∏—Å—Å–∏—é** NDN —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ—à–µ–ª–µ–∫
‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç—ã** —á–µ—Ä–µ–∑ refundStarPayment
‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å** —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º App Store/Play Store

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

### **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- **Telegram:** @your_support_bot
- **Email:** support@yourdomain.com
- **–ö–æ–º–∞–Ω–¥—ã:** /support, /paysupport

### **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://core.telegram.org/bots/payments-stars
- **Bot API:** https://core.telegram.org/bots/api
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Telegram:** @BotSupport

---

## üéâ –ò–¢–û–ì

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É!**

- üè¶ **–°–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ—à–µ–ª–µ–∫** - —Ä–µ–∞–ª—å–Ω—ã–π —Ä–µ–∑–µ—Ä–≤ 1M NDN
- ‚≠ê **Telegram Stars** - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ü§ñ **Telegram Bot** - –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π
- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ø–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
- üöÄ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ** - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

**–í—Ä–µ–º—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: 30 –º–∏–Ω—É—Ç**
**–†–µ–∑—É–ª—å—Ç–∞—Ç: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Telegram Stars! üéâ**
