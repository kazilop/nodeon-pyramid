# ‚úÖ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê –ü–õ–ê–¢–ï–ñ–ï–ô –ó–ê–í–ï–†–®–ï–ù–ê

## üéØ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û:

### **1. Payload –≤ invoice:**
–¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `telegram_id` –≤–º–µ—Å—Ç–æ `user.id`:
```javascript
payload: `ndn_${user.telegram_id}_${amount_ndn}_${transaction.id}`
```
–§–æ—Ä–º–∞—Ç: `ndn_telegram_id_amount_transaction_id`

### **2. Webhook:**
–û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ payload:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `ndn_telegram_id_amount_transaction_id`
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ NDN
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

### **3. Frontend:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `tg.openLink()` –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è invoice
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã

## üìù –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢:

1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ö—É–ø–∏—Ç—å NDN"
2. ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è invoice —Å payload `ndn_telegram_id_amount_transaction_id`
3. ‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è invoice —á–µ—Ä–µ–∑ `tg.openLink()`
4. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç Stars –≤ Telegram
5. ‚úÖ Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç successful_payment –≤ webhook
6. ‚úÖ Webhook –∏–∑–≤–ª–µ–∫–∞–µ—Ç telegram_id –∏ amount
7. ‚úÖ NDN –∑–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
8. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

## üì§ –ó–ê–ì–†–£–ñ–ï–ù–û –ù–ê –°–ï–†–í–ï–†:

- ‚úÖ `server-deployment/routes/payments.js` - –û–±–Ω–æ–≤–ª–µ–Ω payload
- ‚úÖ `server-deployment/webhook.js` - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ PM2 –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- ‚úÖ Nginx –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï:

### **–í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–Ω–æ:**
```
üí≥ –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–∞
‚úÖ Invoice —Å—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞: https://t.me/$...
üì® –ü–æ–ª—É—á–µ–Ω webhook –æ—Ç Telegram
üí≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º successful_payment
üìã –†–∞–∑–±–∏—Ä–∞–µ–º payload
üì§ –ó–∞—á–∏—Å–ª—è–µ–º NDN
‚úÖ NDN –∑–∞—á–∏—Å–ª–µ–Ω—ã
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
ssh root@147.45.110.220 "pm2 logs nodeon-pyramid --lines 100 | grep -E 'üí≥|üì®|‚úÖ NDN|webhook'"
```

## üéâ –†–ï–ó–£–õ–¨–¢–ê–¢:

‚úÖ Invoice —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º payload  
‚úÖ Webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç successful_payment  
‚úÖ NDN –∑–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å  
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ  

–ì–æ—Ç–æ–≤–æ –∫ –ø–æ–ª–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é! üöÄ











