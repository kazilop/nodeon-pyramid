# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø –ü–õ–ê–¢–ï–ñ–ê

## üéØ –ü–†–û–ë–õ–ï–ú–ê:
–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" –ø–ª–∞—Ç–µ–∂ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –¥–∞–ª—å—à–µ

## üîç –ü–†–ò–ß–ò–ù–ê:
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Telegram Stars –Ω–µ –≤—ã–∑—ã–≤–∞–ª—Å—è endpoint `/api/payments/confirm-payment` –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ –∏ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è NDN –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:

### **1. Backend (payments.js):**
‚úÖ –£–ª—É—á—à–µ–Ω endpoint `/api/payments/confirm-payment`:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `transaction_id` –≤ –∑–∞–ø—Ä–æ—Å–µ
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è NDN –ø–æ `transaction_id`

### **2. Frontend (index.html):**
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `/api/payments/confirm-payment` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã:
```javascript
if (status === 'paid') {
    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –ø–ª–∞—Ç–µ–∂ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    const confirmResponse = await fetch('/api/payments/confirm-payment', {
        method: 'POST',
        headers: { 'Authorization': `tma ${tg.initData}` },
        body: JSON.stringify({
            transaction_id: result.transaction_id,
            amount_ndn: result.amount_ndn,
            payment_id: 'stars_payment'
        })
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
    const confirmResult = await confirmResponse.json();
    if (confirmResult.success) {
        // NDN –∑–∞—á–∏—Å–ª–µ–Ω—ã, –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        loadUserData();
    }
}
```

## üì§ –ó–ê–ì–†–£–ñ–ï–ù–û –ù–ê –°–ï–†–í–ï–†:

- ‚úÖ `server-deployment/routes/payments.js` - –£–ª—É—á—à–µ–Ω endpoint
- ‚úÖ `server-deployment/public/index.html` - –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ confirm-payment
- ‚úÖ PM2 –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- ‚úÖ Nginx –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω

## üîÑ –ö–ê–ö –¢–ï–ü–ï–†–¨ –†–ê–ë–û–¢–ê–ï–¢:

1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç invoice –¥–ª—è –æ–ø–ª–∞—Ç—ã
2. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–ª–∞—Ç–µ–∂
3. ‚úÖ Telegram Stars —Å–ø–∏—Å—ã–≤–∞–µ—Ç Stars
4. ‚úÖ Telegram –≤—ã–∑—ã–≤–∞–µ—Ç callback —Å status='paid'
5. ‚úÖ **Frontend –≤—ã–∑—ã–≤–∞–µ—Ç `/api/payments/confirm-payment`** ‚Üê –ù–û–í–û–ï
6. ‚úÖ **Backend –∑–∞—á–∏—Å–ª—è–µ—Ç NDN –Ω–∞ –±–∞–ª–∞–Ω—Å** ‚Üê –ù–û–í–û–ï
7. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
8. ‚úÖ –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

## üéâ –†–ï–ó–£–õ–¨–¢–ê–¢:

–¢–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞:
1. ‚úÖ –ü–ª–∞—Ç–µ–∂ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. ‚úÖ NDN –∑–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
4. ‚úÖ –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!











